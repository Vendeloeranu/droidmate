// Copyright (c) 2012-2016 Saarland University
// All rights reserved.
//
// Author: Konrad Jamrozik, jamrozik@st.cs.uni-saarland.de
//
// This file is part of the "DroidMate" project.
//
// www.droidmate.org

/*
  This project contains classes that:
  - are reused by multiple projects,
  - some of which are to be deployed on an Android device.
  - do not require access to Android API (no android.jar).

  Because some of the classes are deployed on an Android Device, the classes in this project are compiled with Java 7.
*/

apply plugin: 'java'

/* 
   This project has to be built with Java 7. Otherwise the "ant -f build-customized.xml build" of uiautomator-daemon
   fails with:

   [dx] UNEXPECTED TOP-LEVEL EXCEPTION:
   [dx] com.android.dx.cf.iface.ParseException: bad class file magic (cafebabe) or version (0034.0000)

   -----

   N00b reference for the settings below:
   http://stackoverflow.com/questions/16654951/gradle-sourcecompatibility-vs-targetcompatibility
   http://stackoverflow.com/questions/7816423/warning-options-bootstrap-class-path-not-set-in-conjunction-with-source-1-5
*/
sourceCompatibility = JavaVersion.VERSION_1_7
targetCompatibility = JavaVersion.VERSION_1_7
compileJava.configure { JavaCompile jc ->
  // See explanation of this in build.gradle of 'monitor-template' project.
  jc.options.compilerArgs += "-Xlint:-options"
}

/**
 * This build.script is executed twice, once from normal build and once from uiautomator2-daemon build. The applied script
 * allows to install to local maven repo and so can be applied only once. ":projects" doesn't exist when calling this script
 * from uiautomator2-daemon, so the maven.gradle is applied only once, as it should. 
 *
 * For more details why such strange setup, see settings.gradle in uiautoamtor2-daemon.
 */
if (findProject(":projects"))
  apply from: project(":projects").file("maven.gradle")